
# 区块链在电子病历上的应用
## 一、案例
### 简介:  
据报道，上海第一人民医院和安徽省立医院之间已经率先上线区块链下的电子病历，完成联盟电子卡的调通和开卡，制定了统一的电子病历展现标准，近期将上线检查检验报告、结论调阅等一批业务。  
在这之前，阿里健康、MIoT.AI云医链、微信智慧医院3.0、X CARE、IBM Watson Health等早已经将区块链技术应用在医疗数据项目中。  
目前，区块链技术已经越来越多的应用到医疗行业中，其中较为广泛的就是在医疗数据方面的应用 




## 二、分析   

### 行业背景：  
1.由于数据化程度低，各医院之间存在着明显的信息不对称现象。比如说，每个人都会有这样的求医体验，当你去医院看病，医生都会让你去做任何可能相关的检查，然而这些检查每个人都已经在很多医院进行过相应的处理，可是由于医院间相互孤立，病人信息无法同步，由此帯来了巨大的人力物力的浪费，降低了行业的效率，阻碍了行业的快速发展。  
2.虽然法律法规明确保障医疗健康领域的数据安全和隐私，但是互联网的快速发展，使得越来越多的设备开始入网，给网络安全工作带来巨大隐患。患者的就医和身体健康数据难免暴露在这样的信息漏洞里，为不法分子所用，进行违法活动。    
3.随着互联网的发展，医疗健康领域的数字化程度已经不断提高，不管是从医疗设备还是从医疗服务的角度来看，电子化的趋势也越来越明显。然而整体的数据化程度还相对偏低，特别是小型医疗机构对患者的信息保存和保护力度不足。因而信息电子化的需求也越来越强烈。

### 可行性分析
1.分布式存储保证信息安全。区块链采用数据多节点，分布式多重存取，摆脱对互联网中心服务器依赖，避免了中心服务器单点数据篡改、丢失数据的可能性。这也可以有效的提高行业的效率。  
2.非对称加密保证用户隐私。  
3.联盟链社区自治促进信息共享。区块链一方面可以从技术上保障数据共享的实现，另一方面可以从社区自治的角度可以很好的促进大家进行数据的共享。  
4.智能合约提高行业效率。


### 区块链+电子病历的技术运用  
#### 1.智能合约
智能合约是区块链的核心要素，主要指封装区块链系统的各类脚本代码、算法，包括由事件驱动、具有状态、运行在可复制的共享区块链数据账本上的计算机程序和能够实现主动或被动的处理数据、接受、存储和发送价值，以及控制和管理各类链上的智能资产等功能。智能合约能够帮助系统实现复杂的访问控制策略，有助于数据的维护、 存储。   
智能合约模型如图   
![%E5%9B%BE%E7%89%871.png](attachment:%E5%9B%BE%E7%89%871.png) 



#### 2.哈希函数和Merkle树
区块链系统中，节点将一段时间的交易信息进行打包，通过各节点用特定哈希算法将交易分别压缩成一段64位代码（哈希值），两两哈希值继续压缩 生成唯一的哈希值称为 Merkle 树根。使用哈希加密的好处在于哈希函数具有抗碰撞性，且哈希计算时间相同输出长度固定。此外，无论文件有多大，哈希对应过程是无法通过计算反推的。每一个区块头中的哈希值指向前一个区块，形成链式结构。


### 合约运行
区块链技术支持“智能合约”的使用，允许自动化和跟踪某些状态的转换（比如用户权利的变化，或者系统中新记录的诞生）。通过在区块链上的智能合约，记录患者与提供者的关系，将医疗记录与查看权限和数据检索指令（本质上是数据指针）关联起来，以便在外部数据库上执行。在区块链中包含了一个记录的加密哈希，以确保不受篡改，从而保证数据的完整性。 

a.注册合约(RC)：这个全局合约将参与者标识字符串映 射到以太坊地址标识（相当于一个公钥）。这里使用字符串，而不是直接使用加密的公钥身份，从而允许使用已经存在的ID形式。因此，身份登记只能限于认证机构。注册合约（RC）还将身份字符串映射到区块链上的一个地址，在这里可以找到一个称为 “总结合约” 的特殊合约。    
b.医患关系合约(PPRC)：当一个节点存储并管理另一个节点的医疗记录时，系统将在系统的两个节点之间发出患者提供者关系合约。当使用护理提供者和病人的情况时，这个概念扩展到任何成对的数据管理交互。 PPRC定义了各种数据指针和相关的访问权限，它们可以识别由服务提供者所持有的记录。每个指针都包含一个查询字符串，当在提供者的数据库上执行时，返回患者数据的一个子集。 查询字符串与此数据子集的散列相连接，以保证数据在源文件中没有被修改。附加信息表明在网络中可以访问提供者的数据库，即标准网络拓扑中的主机名和端口。数据查询及其相关信息由服务提供者制定，并在添加新记录时进行修改。  
c.总结合约(RC)：总结合约让参与者在系统中找到病历记录。其包含了对患者提供者关系合约（PPRC）的 引用列表，表示所有参与者之前和当 前与系统中其他节点的约定。SC坚持分布式网络，添加关键的备份和恢复功能。患者可以多次离开并重新加入系统，并通过从网络下载最新的区块。 
   
三者关系图如下  
![%E5%9B%BE%E7%89%872.png](attachment:%E5%9B%BE%E7%89%872.png)

### 运作原理简化来说：
1.在建设的公有链上，患者可以选择上传自己的健康病历等相关数据保存在区块链中。  
2.而相关医疗机构、医学研究机构和药品开发组可以在去中心化的患者电子健康病历数据库开展研究和获取数据，通过验证医疗人员的合法性，经过患者的授权之后，获得相关数据的使用权。     
3.在这个过程中，医疗相关机构充当矿工，通过挖矿为患者在区块链上记录和存储数据，而作为回报则是获取相关患者数据，以此实现患者数据的共享问题，也解决了多年了存在的患者数据隐私和共享的矛盾。  
4.相关人员在公共链上数据获取记录和患者的授权记录都保留，做到可查可追。

### 安全性分析
1.防篡改：健康链上的所有信息都是公开不可篡改的，按照一定的时序排列健康链的分布式共识机制使信任建立在密码算法的基础之上，无需依赖可信第3方.数据一且被写入到健康链中就无法被篡改  
2.隐私保护：病人都是以匿名的方式在区块链上参加交易，用户每次交易都可以产生不同的公私钥对。公共账本上不包含用户的身份信息，只包含医疗记录的元数据，医疗记录都加密存放在链下的云存储中。而且对记录的控制权限和控制粒度都掌握在病人手里  
3.安全储存：用户对自己的医疗记录具有所有权，并完全控制它的使用。 从数据的生产到数据的使用过程都是安全的。   
     1) 医疗记录的公共信息( 包括医疗记录元数 据、加密记录的存储位置、哈希值、存取权限等) 都存储在区块链上，公共可见无法篡改。  
     2) 确保了数据来源的机密性、真实性; 云存储的分布式存储特点保证数据存储的安全性;  
     3) 只有授权用户才可以获得解密密钥，查看真实记录。


## 三、总结

### 区块链+电子病历的优势
1.提高数据安全性，降低网络风险。区块链通过加密以及分布式储存等手段，摆脱对互联网中心服务器依赖，避免了中心服务器单点篡改数据、丟失数据的可能性，即保证数据交换系统的安全，防止数据被篡改。  
2.数据加密及共享。区块链在保证安全隐私和可靠的同时,本身也具有公开透明性。以电子病历为例,可以打造一个区块链电子病历系统,患者的所有的就医以及身体健康数据都存储在链上,方便医生对患者有一个全面的了解,并且可以免去各医院之间转院导致的信息不对称问题,需要患者反复进行相同的诊断。    
3.提高行业透明度，减少灰色地带。区块链的安全系数更高，能有效减少信息外露，被不法分子盗取的可能。  
4.可以实现针对一个病人的全面信息做汇总。区块链对患者信息的处理能力更高，有助于对患者信息进行融合和整合，以知识图谱等的呈现形式，为其他服务提供数据基础。  
6.可以使得区块链内的数据存储、流转环节都是密文存储和密文传输。只有得到还有分级授权，分级授权后，还有政府部门审查便利性。  
### 区块链+电子病历的发展阻碍和限制
1.行业数字化程度低。从医院角度来看，总体的数据化水平偏低。从患者角度来看，老龄人口占据很大比重，这部分人群对信息化的认知水平较低。  
2.去中心化实现难度大，分布式存储要求多个节点同时存储和计算各类医疗数据，这会大大的加大各节点的计算压力，导致整体的运营和维护成本上升，绝大多数小型医院难以承受。  
3.医疗数据量巨大。如果将医疗数据内容全部作为上链数据，海量的数据将会导致链上数据过于庞大，储存容量和存储处理速度将面临巨大挑战。  
4.国家强监管领域。医疗健康数据对国家安全、社会稳定方面有着重要作用，国家政策层面难以放开。  

